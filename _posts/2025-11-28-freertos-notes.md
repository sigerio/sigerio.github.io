---
layout: post
title: "FreeRTOS学习笔记"
date: 2025-11-28
category: STM32
tags: [FreeRTOS, RTOS, 嵌入式]
toc: true
---

FreeRTOS移植、任务调度、信号量等核心概念学习笔记。

## 裸机移植注意事项

FreeRTOS强制使用SysTick作为系统时钟，并将其中断优先级设为最低。移植时需注意修改芯片时钟源配置。

## CubeMX移植配置

需要在config文件中添加：

```c
#define vPortSVCHandler    SVC_Handler
#define xPortPendSVHandler PendSV_Handler
#define xPortSysTickHandler SysTick_Handler
```

## 任务调度模式

### 抢占式
高优先级任务优先占用系统资源，低优先级无法抢占。

### 时间片轮询
同优先级任务按时间片轮流执行。

### 协同式
只有当前任务阻塞时，其他任务才能执行。

## 钩子函数

| 钩子类型 | 触发时机 |
|---------|---------|
| 空闲钩子 | 每次执行空闲任务时调用 |
| Tick钩子 | 每次tick中断时调用 |
| 内存申请失败钩子 | 申请内存失败后调用 |
| 守护任务钩子 | 定时器任务创建时调用一次 |

## 信号量

| 类型 | 特点 |
|-----|------|
| 二值信号量 | 只有0和1，使用者和释放者可不同 |
| 互斥锁 | 带优先级继承，使用者和释放者必须相同 |
| 计数信号量 | 可配置最大资源数和初始资源数 |

## 优先级翻转

高优先级任务等待低优先级任务释放资源，而低优先级任务被中优先级任务抢占，导致高优先级任务无法执行。

**解决方案**: 使用互斥量的优先级继承特性。
