---
layout: post
title: "FOC算法深入浅出详解"
date: 2025-12-01
category: 电力电子
tags: [FOC, 电机控制, SVPWM, 矢量控制, 无刷电机]
toc: true
---

> **本文内容总结自**：[【自制FOC驱动器】深入浅出讲解FOC算法与SVPWM技术 - 稚晖君](https://zhuanlan.zhihu.com/p/147659820)

FOC（Field-Oriented Control）磁场定向控制算法的核心原理与实现方法详解。

## 什么是FOC

**FOC（Field-Oriented Control）** 直译为磁场定向控制，也称矢量控制（Vector Control），是目前无刷直流电机（BLDC）和永磁同步电机（PMSM）高效控制的最优方法之一。

### 为什么需要FOC

FOC旨在通过精确控制磁场大小与方向，实现：
- 运动转矩平稳
- 噪声小
- 效率高
- 高速动态响应

简言之，FOC是对无刷电机的**"像素级"控制**方法。

### FOC vs 无刷电调

| 特性 | FOC驱动器 | 无刷电调(ESC) |
|------|----------|--------------|
| 低速控制 | 任意转速精确控制 | 仅高速，低速困难 |
| 换向性能 | 极优，可正反转切换 | 难以换向 |
| 控制模式 | 电流/速度/位置三环 | 仅速度控制 |
| 噪音 | 小（正弦波驱动） | 大（方波驱动） |
| 算法复杂度 | 高 | 低 |
| 成本 | 高 | 低 |


## 电机原理基础

### 基础物理定律

1. **左手定则**：判断导线在磁场中受力方向
2. **右手定则**：判断切割磁感线产生的感生电动势方向
3. **右手螺旋定则**：判断通电线圈极性
4. **PWM脉宽调制**：利用面积等效原理，用离散开关量模拟连续电压

### 无刷电机工作原理

以三相二极内转子电机（星形联结）为例：

- 定子三相绕组产生旋转磁场
- 转子永磁体跟随磁场旋转
- **换相操作由驱动器电子换向完成**（区别于有刷电机的机械换向）

### BLDC vs PMSM

| 特性 | BLDC | PMSM |
|------|------|------|
| 反电动势波形 | 梯形波 | 正弦波 |
| 解决抖动方式 | 增加极对数（硬件） | 正弦波驱动（软件） |
| 控制复杂度 | 较低 | 较高 |

**为什么PMSM更适合FOC**：正弦波反电动势配合SVPWM调制，控制效果更理想。

### 三相逆变驱动电路

采用**三相半桥MOS电路**实现逆变（直流→交流）：

- 每个半桥：上桥臂+下桥臂，中间引出输出线
- 3个半桥组成三相逆变电路
- 开关状态编码：上桥开=1，下桥开=0
- 共8种组合：000~111

## FOC控制原理

### FOC算法Pipeline（9步流程）

1. 采样电机三相电流 $I_a, I_b, I_c$
2. **Clark变换**：$I_a, I_b, I_c$ → $I_\alpha, I_\beta$
3. **Park变换**：$I_\alpha, I_\beta$ → $I_q, I_d$
4. 计算误差：$(I_q - I_{q\_ref})$, $(I_d - I_{d\_ref})$
5. PI控制器输出控制电压 $U_q, U_d$
6. **反Park变换**：$U_q, U_d$ → $U_\alpha, U_\beta$
7. **SVPWM调制**：合成空间电压矢量，输出三相PWM
8. 控制MOS管开关驱动电机
9. 循环执行


### Clark变换

**目的**：将三相非正交坐标系转换为两相正交坐标系（降维）

**为什么需要Clark变换**：
- 三相坐标系$(I_a, I_b, I_c)$是非正交的
- 实际是二维平面，用三个轴表示冗余
- 利用$I_a + I_b + I_c = 0$约束可降为两个变量

**变换公式**：

$$
\begin{bmatrix} I_\alpha \\ I_\beta \end{bmatrix} = 
\begin{bmatrix} 1 & -\frac{1}{2} & -\frac{1}{2} \\ 0 & \frac{\sqrt{3}}{2} & -\frac{\sqrt{3}}{2} \end{bmatrix}
\begin{bmatrix} I_a \\ I_b \\ I_c \end{bmatrix}
$$

**效果**：三个正弦波 → 两个相位差90°的正弦波（仍为非线性）

### Park变换

**目的**：将静止坐标系转换为随转子旋转的坐标系（线性化）

**为什么需要Park变换**：
- $\alpha\beta$坐标系下仍是正弦波，非线性难以控制
- 需要复杂高阶控制器
- **核心思想**：让坐标系跟着转子转，正弦波变成常量！

**变换公式**（$\theta$为转子当前角度）：

$$
\begin{bmatrix} I_d \\ I_q \end{bmatrix} = 
\begin{bmatrix} \cos\theta & \sin\theta \\ -\sin\theta & \cos\theta \end{bmatrix}
\begin{bmatrix} I_\alpha \\ I_\beta \end{bmatrix}
$$

**效果**：两个正弦波 → 两个**常量**（可用简单PI控制）


### $I_q$与$I_d$的物理意义

通过坐标变换，转子磁链被**解耦**为：

- **$I_q$（交轴电流）**：产生转矩的分量 → 我们需要控制的
- **$I_d$（直轴电流）**：径向分量 → 希望控制为0

**为什么$I_d = 0$**：$I_d$不产生有效转矩，只会增加损耗，因此FOC目标之一是保持$I_d = 0$。

### PID控制环

FOC采用**三环嵌套控制**（从内到外）：

| 控制环 | 控制量 | 反馈量 | 控制器 |
|--------|--------|--------|--------|
| 电流环（最内） | $I_q, I_d$ | 电流采样 | PI |
| 速度环 | 转速$\omega$ | 编码器 | PI |
| 位置环（最外） | 角度$\theta$ | 编码器 | P/PID |

**为什么用PI而非PID**：电压-电流关系是一阶惯性环节，不需要微分项。

### 空间电压矢量

**什么是空间电压矢量**：表征我们希望转子旋转到的方向（磁场方向）

三相逆变器8种开关状态对应：
- **6个非零矢量**：$U_1(001)$~$U_6(110)$，组成正六边形
- **2个零矢量**：$U_0(000)$, $U_7(111)$，位于原点

**为什么只有6个方向**：因为只有6种非零开关状态，需要用合成方法产生任意方向。


### SVPWM技术

**SVPWM（空间电压矢量脉宽调制）**：用6个基矢量合成任意空间电压矢量

**核心原理：伏秒平衡**

$$
U_{ref} \cdot T = U_x \cdot T_x + U_y \cdot T_y + U_0^* \cdot T_0^*
$$

- $U_{ref}$：期望的目标电压矢量
- $U_x, U_y$：相邻的两个基矢量
- $T_x, T_y$：各基矢量在周期$T$内的作用时间
- $U_0^*$：零矢量，用于填充剩余时间

**为什么用SVPWM而非SPWM**：母线电压利用率高15%

**七段式调制**：

为减少开关损耗，设计切换顺序使每次只切换一个相：

$$000 \rightarrow 100 \rightarrow 110 \rightarrow 111 \rightarrow 110 \rightarrow 100 \rightarrow 000$$

**六个扇区**：根据$U_{ref}$所在扇区选择对应的基矢量组合

## 总结

FOC的本质是**解耦控制**：

1. **Clark变换**：3维→2维，消除冗余
2. **Park变换**：非线性→线性，简化控制器
3. **反变换+SVPWM**：将控制量转回三相PWM信号

整个过程类似信号处理中的FFT→处理→IFFT：在变换域中更容易处理，再变换回原域应用。

## 参考资料

- [知乎：深入浅出讲解FOC算法与SVPWM技术 - 稚晖君](https://zhuanlan.zhihu.com/p/147659820)
- TI: Field Oriented Control of Permanent Magnet Motors
- 《现代电机控制技术》- 王成元
