---
layout: post
title: "我与FOC的相识"
date: 2025-12-02
category: 电力电子
tags: [FOC, 电力电子, 电机控制]
toc: true
---

## 专有名词解释

| 术语 | 全称 | 解释 |
|------|------|------|
| FOC | Field-Oriented Control | 磁场定向控制，将交流电机控制问题转化为直流电机控制问题 |
| SVPWM | Space Vector PWM | 空间矢量脉宽调制，电压利用率比SPWM高约15% |
| Hall传感器 | Hall Sensor | 霍尔传感器，用于检测转子磁场位置 |
| EKF | Extended Kalman Filter | 扩展卡尔曼滤波，无感控制中估计转子位置和速度 |
| $V_\alpha$/$V_\beta$ | α/β轴电压 | 两相静止坐标系电压分量 |
| $I_q$ | Q-axis Current | Q轴电流，转矩电流 |
| $I_d$ | D-axis Current | D轴电流，励磁电流，通常设为0以最大化转矩效率 |
| BLDC | Brushless DC Motor | 无刷直流电机，采用六步换向控制 |
| PMSM | Permanent Magnet Synchronous Motor | 永磁同步电机，FOC控制的主要对象 |
| PID | Proportional-Integral-Derivative | 比例-积分-微分控制器，FOC中用于电流环和速度环控制 |
| 电角度 | Electrical Angle | 转子磁极与定子参考轴的夹角，$\theta_e = P \cdot \theta_m$ |
| 极对数 | Pole Pairs (P) | 电机转子磁极对的数量，决定电角度与机械角度的关系 |

## FOC控制概述

### 基本信号流程

- 相电压
- 六步换向
- 6路PWM信号由SVPWM产生，通过 $V_\alpha$ 和 $V_\beta$ 产生SVPWM
- Hall传感器得到角度和速度信息

### 位置检测方式

- **有感方式**：Hall传感器获取角度和速度
- **无感方式**：EKF（扩展卡尔曼滤波），$\alpha$ 的电压、电流，$\beta$ 的电压、电流作为输入参数

## FOC控制环路

### 核心模块

- 坐标变换
- SVPWM
- 电流环
- 速度闭环

## PID控制算法详解

### PID基本原理

**PID（比例-积分-微分）** 是FOC中最核心的控制算法，控制公式为：

$$u(t) = K_p \cdot e(t) + K_i \int_0^t e(\tau)d\tau + K_d \frac{de(t)}{dt}$$

其中：
- $u(t)$：控制器输出
- $e(t)$：误差信号（设定值 - 实际值）
- $K_p$：比例增益
- $K_i$：积分增益
- $K_d$：微分增益

### 三个分量的作用

| 分量 | 作用 | 效果 |
|------|------|------|
| P（比例） | 根据当前误差大小产生输出 | 响应快，但会有稳态误差 |
| I（积分） | 累积历史误差产生输出 | 消除稳态误差，但可能引起超调 |
| D（微分） | 根据误差变化率产生输出 | 抑制超调，提高稳定性 |

### FOC中的PID应用

FOC通常采用**双闭环控制**：

1. **内环（电流环）**：
   - 控制对象：$I_d$ 和 $I_q$
   - 响应速度：最快（kHz级）
   - 作用：快速跟踪电流指令

2. **外环（速度环）**：
   - 控制对象：电机转速
   - 响应速度：较慢（百Hz级）
   - 作用：输出 $I_q$ 参考值给电流环

### 参数整定要点

- 先调内环（电流环），后调外环（速度环）
- 电流环带宽应远大于速度环带宽
- 通常 $K_d$ 可设为0（PI控制器即可满足需求）

### 转矩控制

$I_q$ 增大后相当于增加转矩电流，使电机力增大，拖动负载。

## BLDC与FOC对比

| 控制方式 | 速度决定因素 |
|---------|-------------|
| BLDC | 电机速度由换向速度决定 |
| FOC | 电机速度由电机转矩和负载大小决定 |

### FOC转矩-负载关系

- 转矩 = 负载 → 转速恒定不变
- 转矩提升，负载不变 → 转速提高至转矩 = 负载
