---
layout: post
title: "我与FOC的相识"
date: 2025-12-02
category: 电力电子
tags: [FOC, 电力电子, 电机控制]
toc: true
---

## 什么是FOC

**FOC（Field-Oriented Control，磁场定向控制）** 是一种先进的电机控制技术，其核心思想是：通过坐标变换，将交流电机的控制问题转化为类似直流电机的控制问题。

### 为什么叫"磁场定向"

FOC的关键在于建立一个与转子磁场同步旋转的坐标系（dq坐标系）。在这个旋转坐标系中：
- **d轴（直轴）**：始终与转子磁场方向对齐
- **q轴（交轴）**：始终与转子磁场垂直

由于坐标系"定向"于转子磁场，原本随时间变化的交流量在这个坐标系中变成了稳定的直流量，从而可以使用简单的PID控制器进行精确控制。

### FOC的核心优势

相比传统的六步换向控制（BLDC控制），FOC具有以下优势：

**控制精度高**：FOC可以独立控制电机的磁场和转矩，实现更精确的转矩和速度控制。

**运行平滑**：FOC产生连续旋转的磁场，而非离散的六步换向，因此转矩脉动小、噪音低、运行更平滑。

**效率更高**：通过精确控制电流矢量的方向，FOC能够最大化转矩输出效率，减少铜损和铁损。

**宽调速范围**：FOC在低速和高速区域都能保持良好的控制性能。


## 专有名词解释

**FOC（Field-Oriented Control）**：磁场定向控制，将交流电机控制问题转化为直流电机控制问题的核心算法。

**SVPWM（Space Vector PWM）**：空间矢量脉宽调制，一种高效的PWM调制技术，电压利用率比传统SPWM高约15%。

**Hall传感器**：霍尔传感器，利用霍尔效应检测转子磁场位置，是有感FOC的关键器件。

**EKF（Extended Kalman Filter）**：扩展卡尔曼滤波，无感FOC中用于估计转子位置和速度的算法。

**$V_\alpha$/$V_\beta$**：两相静止坐标系（αβ坐标系）中的电压分量。

**$I_d$（D轴电流）**：励磁电流，与转子磁场同向，在PMSM中通常控制为0。

**$I_q$（Q轴电流）**：转矩电流，与转子磁场垂直，直接决定电机输出转矩。

**BLDC（Brushless DC Motor）**：无刷直流电机，通常采用六步换向控制。

**PMSM（Permanent Magnet Synchronous Motor）**：永磁同步电机，FOC控制的主要对象。

**电角度**：转子磁极与定子参考轴的夹角，与机械角度的关系为 $\theta_e = P \cdot \theta_m$，其中P为极对数。

**极对数（P）**：电机转子磁极对的数量，决定电角度与机械角度的关系。


## FOC控制流程概述

FOC的完整控制流程可以分为以下几个阶段：

### 信号采集与处理

首先需要获取电机的运行状态信息：
- **电流采样**：采集三相定子电流 $i_a$、$i_b$、$i_c$
- **位置检测**：获取转子位置角度 $\theta$

位置检测有两种方式：
- **有感方式**：通过Hall传感器或编码器直接测量转子位置
- **无感方式**：通过EKF等算法，利用 $\alpha$、$\beta$ 轴的电压和电流信息估算转子位置

### 坐标变换

采集到的三相电流需要经过两次坐标变换：
1. **Clark变换**：将三相静止坐标系（ABC）转换为两相静止坐标系（αβ），得到 $i_\alpha$ 和 $i_\beta$
2. **Park变换**：将两相静止坐标系（αβ）转换为两相旋转坐标系（dq），得到 $i_d$ 和 $i_q$

### 闭环控制

在dq坐标系中，电流变为直流量，可以使用PID控制器进行闭环控制：
- **电流环**：控制 $I_d$ 和 $I_q$，输出电压参考值 $V_d$ 和 $V_q$
- **速度环**：控制电机转速，输出 $I_q$ 参考值


### 逆变换与输出

控制器输出的电压参考值需要经过逆变换：
1. **反Park变换**：将dq坐标系的 $V_d$、$V_q$ 转换回αβ坐标系的 $V_\alpha$、$V_\beta$
2. **SVPWM调制**：根据 $V_\alpha$ 和 $V_\beta$ 计算生成6路PWM信号，驱动逆变器输出三相正弦电压

## PID控制算法详解

### PID基本原理

**PID（比例-积分-微分）** 是FOC中最核心的控制算法，控制公式为：

$$u(t) = K_p \cdot e(t) + K_i \int_0^t e(\tau)d\tau + K_d \frac{de(t)}{dt}$$

其中：
- $u(t)$：控制器输出
- $e(t)$：误差信号（设定值 - 实际值）
- $K_p$：比例增益
- $K_i$：积分增益
- $K_d$：微分增益

### 三个分量的作用

**P（比例）分量**：根据当前误差大小产生输出。误差越大，输出越大。优点是响应快速，缺点是单独使用会存在稳态误差。

**I（积分）分量**：对历史误差进行累积。只要存在误差，积分项就会不断增大，直到误差消除。优点是能消除稳态误差，缺点是可能引起系统超调和振荡。

**D（微分）分量**：根据误差的变化率产生输出。当误差快速变化时，微分项能提前预测趋势并进行抑制。优点是能抑制超调、提高稳定性，缺点是对噪声敏感。


### FOC中的双闭环控制

FOC通常采用**双闭环控制**结构：

**内环（电流环）**：控制对象是 $I_d$ 和 $I_q$。由于电流变化很快，电流环的响应速度需要最快，通常工作在kHz级别。电流环的作用是快速跟踪电流指令，保证电流波形质量。

**外环（速度环）**：控制对象是电机转速。速度环的响应速度较慢，通常工作在百Hz级别。速度环根据转速误差输出 $I_q$ 参考值给电流环。

### 参数整定要点

- 先调内环（电流环），后调外环（速度环）
- 电流环带宽应远大于速度环带宽
- 通常 $K_d$ 可设为0（PI控制器即可满足需求）

### 转矩控制原理

$I_q$ 增大后相当于增加转矩电流，使电机输出转矩增大，从而能够拖动更大的负载或实现加速。

## BLDC与FOC控制对比

**BLDC（六步换向）控制**：电机速度由换向速度决定，换向频率越高，转速越高。控制相对简单，但转矩脉动大，在低速时表现较差。

**FOC控制**：电机速度由转矩和负载的平衡关系决定。当转矩等于负载时，转速保持恒定；当转矩增大而负载不变时，电机加速，直到新的平衡点。FOC能实现平滑的转矩输出和精确的速度控制。

### FOC转矩-负载-转速关系

- 转矩 = 负载 → 转速恒定不变
- 转矩 > 负载 → 电机加速，转速提高
- 转矩 < 负载 → 电机减速，转速降低
