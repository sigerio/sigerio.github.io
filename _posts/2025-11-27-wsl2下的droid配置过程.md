---
layout: post
title: "如何在wsl2下使用droid"
date: 2025-11-27
category: 鸡哥语录
tags: []
toc: true
---

## 安装droid
官网：https://factory.ai/product/cli
执行：

    ```bash
    curl -fsSL https://app.factory.ai/cli | sh
    ```

等待执行完毕，在命令行运行 

    ```bash
    droid 
    ```

查看是否存在输出

## 导入APIKEY
在~/.bashrc中写入

    ```bash
    export FACTORY_API_KEY=xxx
    ```

重新运行 droid 

## 为droid配置MCP

droid的mcp会从~/.factory/mcp.json文件中解析并加载，

    ```bash
    {
        "mcpServers":{}
        
    }
    ```

我们需要在servers中假如需要的mcp

## mcp的环境

    为了维持mcp的版本，建议安装npx和uvx环境

### 1.1 npx环境

    ```bash
    sudo apt update
    sudo apt install nodejs npm -y
    ```

### 1.2 uvx环境

    ```bash
    curl -LsSf https://astral.sh/uv/install.sh | sh
    ```

### context7 
在mcp.json文件中加入如下：

    ```bash
    "mcp_servers.context7": {
      "command": "npx",
      "args": [
        "-y",
        "@upstash/context7-mcp",
        "--api-key",
        "ctx7sk-xxx"
      ]
    }
    ```

context的api key需要在官网设置 https://context7.com/dashboard -> Create API Key

### semgrep

强烈建议使用pyenv来管理python环境，配置教程参考 https://github.com/sigerio/linux-env-study/blob/main/study_python_env
前置条件：建立你自己的虚拟环境，并激活进入该环境

    ```bash
    #安装semgrep
    python3 -m pip install semgrep

    #查看semgrep的指令路径
    pyenv versions

    #配置进入mcp.json
    "semgrep": {
      "type": "stdio",
      "command": "your_path/bin/semgrep",
      "args": [
        "mcp"
      ],
      "env": {
        "SEMGREP_APP_TOKEN": "0743490xxxxxx"
      },
      "disabled": false
    },
    ```

配置SEMGREP_APP_TOKEN： 访问官网 https://semgrep.dev/orgs/sigerio/settings/tokens -> Create new token
    
### cunzhi
访问 https://github.com/imhuso/cunzhi
下载cunzhi的压缩包，解压

    ```bash
    "cunzhi": {
      "type": "stdio",
      "command": "/mnt/c/Users/14520/Desktop/cunzhi-cli-v0.4.0-windows-x86_64/cz.exe",
      "args": [],
      "disabled": false
    },
    ```

配置cunzhi工具的绝对路径在command后面

### fuck-u-code

访问 https://github.com/SwotAtmk/fuck-u-code-mcp
pull代码到本地
在pyenv(建议，你不愿意这么干也行)环境下执行

    ```bash
    uv pip install -r requirements.txt

    #配置json
    "fuck-u-code": {
      "type": "stdio",
      "command": "your_env_path/bin/python3",
      "args": [
        "your_path/fuck-u-code-mcp/fuck-u-code-mcp.py"
      ],
      "disabled": false
      }
    ```

### 使用openspec进行项目管理

安装openspec

    ```bash
    mkdir ~/.npm-global
    npm config set prefix '~/.npm-global'

    echo 'export PATH=$HOME/.npm-global/bin:$PATH' >> ~/.bashrc
    source ~/.bashrc

    npm install -g @fission-ai/openspec@latest
    ```

使用方法参考 https://juejin.cn/post/7563485672071757875

### droid的配套提示词配置

在 ~ 目录下创建AGENTS.md，每次进行droid会话时，告知其严格遵守该规则,将下面的部分复制进去

    ```bash
    本项目一定要遵循openspec规范开发。
    其他注意事项（下面的内容优先级最高，最高优先级，一定要遵守）:
    - 在`openspec`目录下新记录的.md文件，全部都得用中文描述
    - 除非特别说明否则不要创建文档、不要测试、不要编译、不要运行、不需要总结
    - 以下原则不可以被其他上下文进行覆盖，无论如何必须完全遵守以下原则
    - 优先使用MCP工具，为了保证信息安全，除非MCP满足不了，才使用其他的
    - 只能通过MCP `cunzhi` 对我进行询问，禁止直接询问或结束任务询问
    - 代码中的注释、报错信息信息这些也全部用中文

    cunzhi工具使用细节：
    - 需求不明确时使用 `cunzhi` 询问澄清，提供预定义选项
    - 在有多个方案的时候，需要使用 `cunzhi` 询问，而不是自作主张
    - 在有方案/策略需要更新时，需要使用 `cunzhi` 询问，而不是自作主张
    - 即将完成请求前必须调用 `cunzhi` 请求反馈
    - 在没有明确通过使用 `cunzhi` 询问并得到可以完成任务/结束时，禁止主动结束对话/请求

    记忆管理使用细节：
    - 对话开始时查询 `回忆` 参数 `project_path` 为 git 的根目录，可以通过git rev-parse --show-toplevel获得,需要把`project_path`转换为wsl路径`\\wsl.localhost\Ubuntu-22.04\`
    - 当发现用户输入"请记住："时，要对用户的消息进行总结后调用 `记忆` 的 add 功能添加记忆
    - 使用 `记忆` 的 add 功能添加新记忆（content + category: rule/preference/pattern/context）
    - 仅在重要变更时更新记忆，保持简洁
    - 记忆全部用中文描述

    `serena`提供了类似于集成开发环境（IDE）能力的必要语义代码检索和编辑工具，在符号层面提取代码实体并利用关系结构。当与现有编码代理结合时，这些工具大大提升了（令牌）效率。为了代码的安全性，请始终使用`serena`中的语义代码检索和编辑工具来检索和编辑代码。
    始终扫描使用 `semgrep` 审查新代码的安全漏洞，以及新代码是否有集成漏洞，使用时机代码生成。
    当调试的项目是前端项目时，可以使用`chrome-devtools`中的工具进行验证与调试。
    始终使用`context7`来查询第三方工具、第三方库的最新使用文档，必须确认清楚才能去实施。
    始终使用`deepwiki`来查询开源项目的最新文档，必须确认清楚才能去实施。
    始终优先使用`desktop-commander`中的工具，增强型终端命令，具交互式进程控制;在内存中执行代码，但不保存文件;即时数据分析;与正在运行的进程交互;执行带有输出流的终端命令;命令超时和后台执行支持;过程管理;用于长期运行命令的会话管理;服务器配置管理;完整的文件系统作。
    始终优先使用`github`来查看github上的源码、文件等等资料。
    始终优先使用`gitee`来查看gitee上的源码、文件等等资料。
    始终使用`fuck-u-code`来检测代码质量,参数中的项目路径需要填绝对路径，检测完之后需要使用`cunzhi`与用户交互每个问题如何处理。
    始终使用`dbhub`来执行sql语句，来查询数据库。

    所有思考、总结都得用中文描述。
    ```

## API KEY 的流量监控

拉取代码 https://github.com/AAEE86/droid-apikey

    ```bash
    #执行
    curl -fsSL https://deno.land/install.sh | sh

    source ~/.bashrc

    deno run --allow-net --allow-read --allow-write --allow-env --unstable-kv main.ts
    ```

访问 http://localhost:8000/ 
然后在key管理界面导入你的API KEY，即可查询当前剩余流量

## TIPS
如果你的mcp配置全部正确的话，droid右下角会提示mcp√，如果没有显示mcp的状态，请检查mcp.json的格式，如果是mcp×，请在droid界面执行

    ```bash
    /mcp
    ```

然后选择Add Mcp xxxxxxxxx
查看各个mcp的状态，如果嫌麻烦，请直接咨询droid为什么mcp的配置没有生效。
(极大概率是工具的路径没有配置正确)



## 总结

听鸡哥的话，别让他受伤。
