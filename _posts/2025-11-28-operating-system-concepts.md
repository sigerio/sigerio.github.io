---
layout: post
title: "操作系统核心概念"
date: 2025-11-28
category: Linux
tags: [操作系统, 进程, 线程, 内存管理]
toc: true
---

理解进程、线程、内存管理等操作系统核心概念。

## 线程与进程

线程是系统独立调度和分派的基本单位。在源码层面，进程是一个结构体，包含了线程结构体。

## CPU资源共享

在单核计算机里，CPU无法被多个程序并行使用。

没有操作系统时，程序独占全部CPU。为了让多任务共享CPU，程序员需要安排运行计划，这后来成为OS的核心组件——**调度器(scheduler)**。

调度器将单个CPU的运行拆分成一段段的"运行片"，轮流分给不同程序，因切换速度极快，制造出多程序并行的假象。

## 内存管理

内存可被多个程序共用，但会引出麻烦。早期需要手工为每个程序安排运行空间，这种定制方案没有可行性。

为解决这个问题，引入了**虚拟地址**概念：

### 硬件层面
CPU增加MMU模块，负责转换虚拟地址和物理地址。

### 操作系统层面
增加内存管理模块(memory management)，管理物理内存、虚拟内存相关事务。

### 应用程序层面
发明了**进程**模型：
- 每个进程使用完全一样的虚拟地址空间
- 经由OS和MMU协作，映射到不同物理地址空间
- 不同进程有各自独立的物理内存空间

## 线程模型

有些程序想要共享CPU，**并且共享同样的物理内存**，这时线程模型出现了：
- 被包裹在进程里
- 在调度器管理下共享CPU
- 拥有同样的虚拟地址空间和物理地址空间
- 无法越过包裹自己的进程访问别的进程

## 进程间共享内存

符合POSIX规范的操作系统提供`mmap`接口，可以把一个物理地址空间映射到不同进程中共享。

**注意**：在有的操作系统里（如VxWorks），进程不是调度单位，线程是最基本的调度单位。

## 临界区

同一时间只允许一个线程访问。当线程进入临界区后，应保证离开临界区的语句可以执行，否则资源将一直被占用。

## OS结构（从下往上）

| 层级 | 功能 |
|------|------|
| 人机交互层 | 用户接口 |
| 文件管理层 | 管理文件的软件 |
| I/O管理层 | 管理硬件I/O（虚拟机） |
| 底层硬件 | 裸机 |

## 基本特性

并发、共享、虚拟、异步

## 基本功能

- **进程管理**：调度
- **内存管理**：存储
- **设备管理**：硬件
- **文件管理**：安全

## 设计思路

分层设计，由A0-An层构成，确保Ai为Ai-1的扩展。修改任意Ax层软件，只对Ax+1层的接口使用有影响，保证系统基础稳固。
